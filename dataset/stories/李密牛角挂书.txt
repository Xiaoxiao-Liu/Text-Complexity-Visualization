隋炀帝第一次进攻高丽，被打得大败。一百多万隋军兵士，逃回来的只有二千七百人。这样的惨败，并没有使这个骄横的暴君死心。才隔一年，他又发动第二次对高丽的进攻。他亲自率领大军攻打辽东，派大臣杨玄感在后方黎阳督运粮草。 杨玄感的父亲杨素，原是隋炀帝的亲信，帮助炀帝夺取皇位。后来受到炀帝猜忌，郁郁不乐地死去。杨玄感为这个对隋炀帝早就不满，这一回看到局势混乱，就想利用这个时机推翻隋炀帝。 杨玄感用督运粮草的名义，征发了年青力壮的民伕、船工八千多人，要他们运粮到辽东前线。那些年青人怨透了劳役，听说叫他们远离家乡去干苦差使，更加气愤。 有一天，杨玄感把民伕集合在一起，说：“当今皇上不顾百姓的死活，让成千上万的父老兄弟死在辽东，这种情况不能再忍受下去。我也是被逼来干这件事的。现在我决心跟大伙一起，推翻暴君。你们看怎么样？” 大伙儿一听有人带头反对朝廷，怎么不愿意，顿时响起一片欢呼声。 杨玄感把八千民伕编成队伍，发给武器，准备进攻隋军。他发现他身边缺少一个谋士帮他出谋划策，不禁想起了正在长安的好朋友李密。 李密的上代是北周和隋朝的贵族。李密少年时候，被派在隋炀帝的宫廷里当侍卫。他生性灵活，在值班的时候，左顾右盼，被隋炀帝发现了，认为这孩子不大老实，就免了他的差使。李密并不懊丧，回家以后，发愤读书，决定做个有学问的人。 有一回，李密骑了一条牛，出门看朋友。在路上，他把《汉书》挂在牛角上，抓紧时间读书。正好宰相杨素坐着马车在后面赶上来，看到前面有个少年在牛背上读书，暗暗奇怪。 杨素在车上招呼说：“哪个书生，这么用功啊？” 李密回过头来一看，认得是宰相，慌忙跳下牛背，向杨素作了一个揖，报了自己的名字。 杨素问他说：“你在看什么？” 李密回答说：“我在读项羽的传记。” 杨素跟李密亲切地谈了一阵，觉得这个少年人很有抱负。回家以后，杨素跟他儿子杨玄感说：“我看李密这孩子的学识、才能，比你们几个兄弟强得多。将来你们有什么紧要的事，可以找他商量。” 打那以后，杨玄感就跟李密交上了朋友。 这回杨玄感要找谋士，想起他父亲的叮嘱，就派人到长安，把李密接到黎阳来。 李密到了黎阳，杨玄感向他请教：要推翻隋炀帝，这个仗该怎么打法。 李密说：“要打败官军，有三种办法。第一，皇上现在在辽东，我们带兵北上，截断昏君退路。他前有高丽，后无退路，不出十天，军粮接济不上，我们不用打也能取胜，这是上策。第二是向西夺取长安，抄他们的老巢。官军如果想退军，我们就拿关中地区做根据地，凭险坚守，这是中策。第三是就近攻东都洛阳。不过这可是一条下策。因为朝廷在东都还留着一部分守兵，不一定能很快攻得下来。” 杨玄感急于求成，听完这三条计策，觉得前两条都太费时间，说：“我看你说的下策，倒是个好计策。现在朝廷官员家属，都在东都。我们攻下东都，把家属都俘虏起来。官军军心动摇，保管能取胜。” 杨玄感立刻从黎阳出兵攻打东都，一路上，有许多农民踊跃参加起义军，队伍扩大到十万人，接连打了几个胜仗。隋炀帝正在带领大军猛攻辽阳，得到告急文书，连夜退兵，派大将宇文述等带领大军分路攻杨玄感。杨玄感抵挡不住，想往西退到长安去。宇文述带兵跟踪追击，最后，把杨玄感的人马围住。杨玄感没路可走，终于被杀。  李密从混乱中逃了出来，想偷偷地逃回长安。但是隋军搜捕得很紧，李密还是被抓住了。 隋将派兵把李密押送到隋炀帝的行营去。半路上，李密跟十几个犯人一商量，把他们随身带的钱财都送给押送的隋兵，供他们吃喝。隋兵受了他们的贿赂，喝酒作乐，防备松懈下来。李密他们就趁隋兵酒醉糊涂的时候，瞅个机会跳墙逃跑了。 李密脱离危险以后，想另找机会，反抗隋朝。他想找个起义军的首领作靠山，但是有的起义军首领看他是个文弱书生，不大重视他。李密没办法，只好改姓换名，东躲西藏，几次险点儿被官府抓去。最后，他听说东郡（今河南滑县东）瓦岗寨有一支起义军，兵力很强。带头的叫做翟（音ｚｈáｉ）让，为人厚道，又喜欢结交英雄，就决定上东郡去投奔瓦岗军。